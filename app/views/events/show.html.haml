%h2.text-center.mb-3 イベント詳細

.row.justify-content-center
  .col-md-7
    .card.mb-3.shadow-sm.border-0.rounded-3
      .card-body.py-3.text-center
        - if user_signed_in?
          .position-absolute.top-0.end-0.mt-3.me-3
            - if @event.user != current_user && @event.upcoming?
              - entry = current_user.entries.find_by(event_id: @event.id)
              - if entry.nil?
                = button_to event_entry_path(@event), class: 'btn btn-sm btn-outline-primary' do
                  参加申し込み
              - elsif entry.accepted? || entry.rejected?
                = render 'shared/entry_status_badge', entry:
              - else
                = button_to event_entry_path(@event), method: :delete, class: 'btn btn-sm btn-primary' do
                  参加申し込み中
        %h4.card-title.fw-semibold.mb-3= @event.title
        %p.mb-2
          %strong= @event.description
        %p.mb-2
          作成者：
          %strong.text-success= @event.user.name
        %p.mb-2
          開催日時：
          %strong= l(@event.started_at, format: :default)
        %p.mb-2
          開催場所：
          %strong= @event.venue
        %p.mb-2
          参加人数：
          %strong
            = @event.entries_count
            人
        %span.badge.bg-primary.fs-6
          .bi.bi-tag= @event.category.name

        - if @event.user == current_user
          .text-end
            = link_to '編集', edit_users_event_path(@event), class: 'btn btn-sm btn-outline-warning me-2'
            = button_to '削除',
                        users_event_path(@event),
                        method: :delete,
                        data: { turbo_confirm: '本当に削除しますか？' },
                        form: { class: 'd-inline' },
                        class: 'btn btn-sm btn-outline-danger'

  - if @event.past?
    .text-center.mb-3
      - if @event.reviews.find_by(user: current_user).nil?
        = link_to 'レビューを投稿する', new_event_review_path(@event), class: 'btn btn-link text-secondary'
      - else
        %p 既にレビューを投稿済みです。

  - @event.reviews.preload(:user).order(created_at: :desc, id: :desc).each do |review|
    .card.mb-3.shadow-sm.rounded-3
      .card-body
        .d-flex.justify-content-between.align-items-center.mb-2
          %strong= review.user.name
          %small.text-muted= l(review.created_at, format: :short)
        .mb-2
          - 5.times do |i|
            - if i < review.rating
              %span.text-warning.bi.bi-star-fill
            - else
              %span.text-secondary.bi.bi-star
        %p= review.comment.presence || 'コメントなし'

        - if review.user == current_user
          .text-end
            = link_to '編集', edit_event_review_path(@event, review), class: 'btn btn-outline-warning me-2'
            = button_to '削除',
                        event_review_path(@event, review),
                        method: :delete,
                        data: { turbo_confirm: '本当に削除しますか？' },
                        form: { class: 'd-inline' },
                        class: 'btn btn-sm btn-outline-danger'

.text-center.mt-3
  = link_to '未開催イベント一覧へ', upcoming_events_path, class: 'btn btn-outline-primary me-3'
  - if @event.user == current_user
    = link_to '参加者一覧へ', users_event_entries_path(@event), class: 'btn btn-outline-secondary'
